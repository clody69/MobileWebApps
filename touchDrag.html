<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--[if lt IE 7]> <html class="no-js ie6" lang="en"> <![endif]-->
<!--[if IE 7]> <html class="no-js ie7" lang="en"> <![endif]-->
<!--[if IE 8]> <html class="no-js ie8" lang="en"> <![endif]-->
<!--[if gt IE 8]> ><! <![endif]-->
<html class='no-js' lang='en'>
<!-- <![endif] -->
<head>
<meta charset='utf-8' />
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible' />
<title>
Mobile Web Applications Develeopment with HTML5
</title>
<meta content='A course on developing mobile web applications with HTML5' name='description' />
<meta content='Claudio Riva' name='author' />
<meta content='width=1024' name='viewport' />
<!-- Core and extension CSS files -->
<link href='css/documentation.css' rel='stylesheet' />
<link href='css/coderay_dark.css' rel='stylesheet' />
<!-- /%link(href="css/pygments.css" rel="stylesheet") -->
<script type='text/javascript'>
  //<![CDATA[
    !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="http://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
  //]]>
</script>
<script type='text/javascript'>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-29188416-1']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  //]]>
</script>
</head>
<body>
<div id='main'>
<div id='header-wrapper'>
<div class='basic' id='header'>
<div class='title'>
Mobile Web Applications Development with HTML5
</div>
</div>
</div>
<div id='menu'>
<ul>
<li>
<a href='index.html#'>Home</a>
</li>
<li>
<a href='lectures.html'>Lectures</a>
</li>
<li>
<a href='index.html#Schedule'>Schedule</a>
</li>
<li>
<a href='examples.html'>Examples</a>
</li>
<li>
<a href='talks.html'>Talks</a>
</li>
<li>
<a href='resources.html'>Resources</a>
</li>
<li>
<a href='course_2012_1.html'>Spring 2012</a>
</li>
<li>
<a href='index.html#About'>About</a>
</li>
</ul>
</div>
<div id='wrapper'>
<a class='twitter-follow-button' data-show-count='false' data-show-screen-name='false' data-size='large' href='https://twitter.com/aaltowebapps'>Follow @aaltowebapps</a>
<div class='content-wrapper'>
<h1>Touch Drag</h1><div class='actions'><a href='examples/touchDrag'>Try it</a><a href='https://github.com/aaltowebapps/MobileWebAppsExamples/tree/master/touchDrag'>Browse Source Code</a></div>
<p>
In this example we allow the user to drag a cube around on the screen of the device by listening to the
mouse and touch events. The example works on a pc or with a touch device.
</p>
<p>
Using CSS we define the red square:
</p>
<div class='code_block'>
<div class='code_header'>
index.html.haml
</div>
<div class="CodeRay">
  <div class="code"><pre><span class="class">.square</span> {&#x000A;  <span class="key">height</span>: <span class="float">100px</span>;&#x000A;        <span class="key">width</span>: <span class="float">100px</span>;&#x000A;        <span class="key">background-color</span>: <span class="value">red</span>;&#x000A;        <span class="key">position</span>: <span class="value">absolute</span>;&#x000A;        <span class="key">top</span>: <span class="float">15px</span>;&#x000A;        <span class="key">left</span>: <span class="float">15px</span>;&#x000A;        <span class="key">color</span>: <span class="value">white</span>;&#x000A;        <span class="key">text-align</span>: <span class="value">center</span>;&#x000A;}</pre></div>
</div>
</div>
<p>
For the touch interaction we must bind to the
<span class='terminal'>touchstat</span>
and
<span class='terminal'>touchend</span>
events. Once we receive a
<span class='terminal'>touchstart</span>
event, we start tracking the movements of the finger using the
<span class='terminal'>
touchmove
</span>
event.
</p>
<p>
Note that in certain browsers or devices, it's better to disable the
<span class='terminal'>
mousedown
</span>
event when you are sure the user is interacting with a touch device.
</p>
<div class='code_block'>
<div class='code_header'>
index.html.haml
</div>
<div class="CodeRay">
  <div class="code"><pre><span class="keyword">var</span> square = <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">.square</span><span class="delimiter">'</span></span>);&#x000A;&#x000A;square.on(<span class="string"><span class="delimiter">'</span><span class="content">touchstart</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>(e){&#x000A;  setOffset(e);&#x000A;  square.on(<span class="string"><span class="delimiter">'</span><span class="content">touchmove</span><span class="delimiter">'</span></span>, drag);&#x000A;  <span class="comment">//square.off('mousedown');</span>&#x000A;});&#x000A;square.on(<span class="string"><span class="delimiter">'</span><span class="content">touchend</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>(e) {&#x000A;  square.off(<span class="string"><span class="delimiter">'</span><span class="content">touchmove</span><span class="delimiter">'</span></span>);&#x000A;});&#x000A;</pre></div>
</div>
</div>
<p>
To support the mouse interaction, we listen to the
<span class='terminal'>mousedown</span>
and
<span class='terminal'>mouseup</span>
events. We use the
<span class='terminal'>mousemove</span>
event to track the movement of the mouse and update the position of the cube.
</p>
<div class='code_block'>
<div class='code_header'>
index.html.haml
</div>
<div class="CodeRay">
  <div class="code"><pre>square.on(<span class="string"><span class="delimiter">'</span><span class="content">mousedown</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>(e) {&#x000A;  setOffset(e);&#x000A;  square.on(<span class="string"><span class="delimiter">'</span><span class="content">mousemove</span><span class="delimiter">'</span></span>, drag);&#x000A;});&#x000A;&#x000A;square.on(<span class="string"><span class="delimiter">'</span><span class="content">mouseup</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>(e) {&#x000A;   square.off(<span class="string"><span class="delimiter">'</span><span class="content">mousemove</span><span class="delimiter">'</span></span>);&#x000A; });&#x000A;</pre></div>
</div>
</div>
<p>
The main logic for updating the position of the cube is shown below. Note that touch and mouse events
have two different ways for retrieving the position of the event. This difference has been captured
withing the
<span class='terminal'>
getPos
</span>
function.
</p>
<div class='code_block'>
<div class='code_header'>
index.html.haml
</div>
<div class="CodeRay">
  <div class="code"><pre><span class="keyword">var</span> offsetX, offsetY;&#x000A;&#x000A;<span class="keyword">function</span> <span class="function">getPos</span>(e) {&#x000A; <span class="keyword">var</span> coord = [];&#x000A; <span class="keyword">if</span> (e.originalEvent.touches &amp;&amp; e.originalEvent.touches.length) {&#x000A;   coord[<span class="integer">0</span>] = e.originalEvent.touches[<span class="integer">0</span>].clientX;&#x000A;   coord[<span class="integer">1</span>] = e.originalEvent.touches[<span class="integer">0</span>].clientY;&#x000A;        } <span class="keyword">else</span>&#x000A;        {&#x000A;   coord[<span class="integer">0</span>] = e.clientX;&#x000A;   coord[<span class="integer">1</span>] = e.clientY;&#x000A;        }&#x000A; <span class="keyword">return</span> coord;&#x000A;}&#x000A;&#x000A;<span class="keyword">function</span> <span class="function">setOffset</span>(e) {&#x000A; <span class="keyword">var</span> coord = getPos(e);&#x000A; offsetX = coord[<span class="integer">0</span>] - square.position().left;&#x000A; offsetY = coord[<span class="integer">1</span>] - square.position().top;&#x000A;}&#x000A;&#x000A;<span class="keyword">function</span> <span class="function">drag</span>(e) {&#x000A; <span class="keyword">var</span> coord = getPos(e);&#x000A; square.css(<span class="string"><span class="delimiter">'</span><span class="content">left</span><span class="delimiter">'</span></span>, coord[<span class="integer">0</span>] - offsetX + <span class="string"><span class="delimiter">'</span><span class="content">px</span><span class="delimiter">'</span></span>);&#x000A; square.css(<span class="string"><span class="delimiter">'</span><span class="content">top</span><span class="delimiter">'</span></span>, coord[<span class="integer">1</span>] - offsetY + <span class="string"><span class="delimiter">'</span><span class="content">px</span><span class="delimiter">'</span></span>);&#x000A;        <span class="keyword">return</span> <span class="predefined-constant">false</span>;        &#x000A;}</pre></div>
</div>
</div>

</div>
</div>
</div>
<div id='footer'>
<div class='sponsor'>
<a href='http://www.aalto.fi/'><img src='imgs/aaltouni.png' /></a>
<a href='http://www.nokia.com/'><img src='imgs/nokia.png' /></a>
<a href='http://www.sc5.io'><img src='imgs/SC5.jpg' /></a>
<a href='http://corporate.foreca.com/en/'><img src='imgs/foreca.png' /></a>
</div>
</div>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--[if lt IE 7]> <html class="no-js ie6" lang="en"> <![endif]-->
<!--[if IE 7]> <html class="no-js ie7" lang="en"> <![endif]-->
<!--[if IE 8]> <html class="no-js ie8" lang="en"> <![endif]-->
<!--[if gt IE 8]> ><! <![endif]-->
<html class='no-js' lang='en'>
<!-- <![endif] -->
<head>
<meta charset='utf-8' />
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible' />
<title>
Mobile Web Appplications Development with HTML5
|
Aalto University March 2011
</title>
<meta content='A course on developing mobile web applications with HTML5' name='description' />
<meta content='Claudio Riva' name='author' />
<meta content='width=1024, user-scalable=no' name='viewport' />
<!-- Coloring for code. To be included before the custom css like course and screen -->
<link href='css/coderay.css' rel='stylesheet' />
<!-- Core and extension CSS files -->
<link href='deckjs/core/deck.core.css' rel='stylesheet' />
<link href='deckjs/extensions/goto/deck.goto.css' rel='stylesheet' />
<link href='deckjs/extensions/menu/deck.menu.css' rel='stylesheet' />
<link href='deckjs/extensions/navigation/deck.navigation.css' rel='stylesheet' />
<link href='deckjs/extensions/status/deck.status.css' rel='stylesheet' />
<link href='deckjs/extensions/hash/deck.hash.css' rel='stylesheet' />
<!-- /%link(href="deckjs/extensions/scale/deck.scale.css" rel="stylesheet") -->
<!-- / %link(href="deckjs/extensions/notes/deck.notes.css" rel="stylesheet") -->
<!-- Theme CSS files (menu swaps these out) -->
<link href='css/course.css' id='style-theme-link' rel='stylesheet' />
<link href='deckjs/themes/transition/horizontal-slide.css' id='transition-theme-link' rel='stylesheet' />
<link href='css/screen.css' media='screen, projection' rel='stylesheet' type='text/css' />
<script src='js/jquery.min.js'></script>
<!-- Custom CSS just for this page -->
<script src='js/modernizr.custom.js'></script>
</head>
<body>
<div id='background'>
<div class='background front active' id='bg-default'></div>
<div class='background back' id='bg-default'></div>
</div>
<article class='deck-container'>
<section class='slide main-title'>
<h1>
Mobile Web Appplications Development with HTML5
</h1>
<img src='imgs/HTML5_logo.png' />
<br />
<h1 class='subtitle'>
Lecture 3: Web Sockets
</h1>
<br />
<div class='smaller centered'>
<h3>
Claudio Riva
</h3>
<h3>
Aalto University March 2011
</h3>
</div>
</section>

<section class='slide section-title'>
<h1>Lesson 3:</h1>
</section>
<section class='slide'>
<header>
Push Technology
</header>
<article>
<p>HTTP request/response protocol is designed for pulling information from a server and doesn't fit well for real-time communication</p>
<p>Typical applications that need server push: Instant messaging, E-mail, Auctions, Betting, Gaming, Sport results, Sensor monitoring</p>
<div class='singlespace'>
<p>Workarounds</p>
</div>
<ul>
<li>Frequent requests (=> excessive load on the server)</li>
<li>Long polling (=> keep many connections open in waiting state)</li>
<li>Flash XMLSocket relays</li>
</ul>
<p>Library hiding complexity: socket.io</p>
</article>
</section>
<section class='slide'>
<header>
<img src = "imgs/html5/HTML5_Connectivity_64.png">WebSockets</img>
</header>
<article>
<blockquote>
<p class='smallest'>
Full-duplex, bi-directional communication over the Web.  Both the server and client can send data at any time, or even at the same time. Only the data itself is sent, without the overhead of HTTP headers, dramatically reducing bandwidth.
</p>
</blockquote>
<div class='code_block larger'>
<div class="CodeRay">
  <div class="code"><pre><span class="comment">//Socket object</span>&#x000A;<span class="keyword">var</span> socket = <span class="keyword">new</span> WebSocket(<span class="string"><span class="delimiter">&quot;</span><span class="content">ws://echo.websocket.org</span><span class="delimiter">&quot;</span></span>);&#x000A;&#x000A;<span class="comment">// Callbacks</span>&#x000A;socket.<span class="function">onopen</span> = <span class="keyword">function</span>(event) { socket.send(<span class="string"><span class="delimiter">'</span><span class="content">Hello, WebSocket</span><span class="delimiter">'</span></span>); };&#x000A;socket.<span class="function">onmessage</span> = <span class="keyword">function</span>(event) { alert(event.data); }&#x000A;socket.<span class="function">onclose</span> = <span class="keyword">function</span>(event) { alert(<span class="string"><span class="delimiter">'</span><span class="content">closed</span><span class="delimiter">'</span></span>); }&#x000A;</pre></div>
</div>
</div>
</article>
</section>
<section class='slide'>
<header>
<img src = "imgs/html5/HTML5_Connectivity_64.png">WebSockets</img>
</header>
<article>
Websockets interface:
<ul>
<li>
<strong class='red'>
onopen
</strong>
: callback when the socket is ready (important!)
</li>
<li>
<strong class='red'>
onmessage
</strong>
: callback when a message is received on the socket
</li>
<li>
<strong class='red'>
onclose
</strong>
: callback when the socket is closed
</li>
<li>
<strong class='red'>
onclose
</strong>
: callback when there is a communication error
</li>
</ul>
<p>
Messages are in UTF-8:
<div class='centered terminal larger'>
"<div class='gray'>\\x00</div>Hello World<div class='gray'>\\xFF</div>"
</div>
</p>
<div class="CodeRay">
  <div class="code"><pre>socket.send(<span class="string"><span class="delimiter">'</span><span class="content">Hello World</span><span class="delimiter">'</span></span>);&#x000A;</pre></div>
</div>
</article>
</section>
<section class='slide'>
<header>
benefits
</header>
<article>
<div class='row'>
<div class='twoColumn'>
<ul>
<li>connection handshake uses HTTP infrastructure</li>
<li>no extra ports (works across firewalls)</li>
<li>no overhead</li>
<li>very low latency</li>
<li>clean browser interface</li>
</ul>
</div>
<div class='twoColumn'>
<pre class='smaller'>Request URL:ws://localhost:8080/
Request Method:GET
Status Code:101 Switching Protocols
<strong>Request Headers</strong>
Connection:Upgrade
Cookie:
Host:localhost:8080
Origin:null
Sec-WebSocket-Key:0/D8yRVfxGk/G4i4ye2MDA==
Sec-WebSocket-Version:13
Upgrade:websocket
(Key3):00:00:00:00:00:00:00:00
<strong>Response Headers</strong>
Connection:Upgrade
Sec-WebSocket-Accept:yBMC36LCd79X4ByuhFJfYJ3VS+Y=
Upgrade:websocket
(Challenge Response):00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00</pre>
</div>
</div>
</article>
</section>
<section class='slide'>
<header>
<img src = "imgs/html5/HTML5_Connectivity_64.png">Sending Data Structures</img>
</header>
<article>
Websockets interface:
</article>
</section>
<section class='slide'>
<header>
Pusher.com
</header>
<article>
<div class='row'>
<div class='twoColumn'>
<div class='autobox'>
<p>
<strong>Pusher</strong>
is a simple hosted API for quickly, easily and securely adding realtime bi-directional functionality via WebSockets to web and mobile apps, or any other Internet connected device.
</p>
<p>Founded in 2009. Team is 5 members.</p>
<p>40 billion messages delivered.</p>
<p>WebSocket as a service</p>
<p>Using EM-WebSocket</p>
</div>
</div>
<div class='twoColumn'>
<div class='image-wrap'><img src='imgs/pusher_diagram.png' /></div>
</div>
</div>
</article>
</section>

<!-- Elements -->
<a class='deck-next-link' href='#' title='Next'>â†’</a>
<a class='deck-prev-link' href='#' title='Previous'>&#8592;</a>
<p class='deck-status'>
<span class='deck-status-current'></span>
/
<span class='deck-status-total'></span>
</p>
<a class='deck-permalink' href='.' title='Permalink to this slide'>#</a>
<script src='deckjs/core/deck.core.js'></script>
<script src='deckjs/extensions/menu/deck.menu.js'></script>
<script src='deckjs/extensions/goto/deck.goto.js'></script>
<script src='deckjs/extensions/status/deck.status.js'></script>
<script src='deckjs/extensions/navigation/deck.navigation.js'></script>
<script src='deckjs/extensions/hash/deck.hash.js'></script>
<!-- /%script(src="deckjs/extensions/scale/deck.scale.js") -->
<!-- /%script(src="deckjs/extensions/notes/deck.notes.js") -->
<script src='js/main.js'></script>
<script type='text/javascript'>
  //<![CDATA[
    $(document).bind('deck.change', function(event, from, to) {
     
      //alert('Moving from slide ' + from + ' to ' + to);
      var f = $.deck('getSlide', from).closest('section').attr("data-background");
      var t = $.deck('getSlide', to).closest('section').attr("data-background");
      if (t==undefined) { t = "bg-default"; }
      if (f==undefined) { f = "bg-default"; }
             
      
      var front = $('#background > .front').first();
      var back = $('#background > .back').first();
    
      if (front.hasClass('active')) {
        if (front.attr('id') == t) { return; }
    
        back.attr('id',t);
        front.removeClass('active');
        back.addClass('active');
        front.css('opacity',0);
      } else {
        if (back.attr('id') == t) { return; }
    
        front.attr('id',t);
        back.removeClass('active');
        front.addClass('active');
        front.css('opacity',1);
      }
      
      //last.attr('id',active.attr('id'));
      //last.css('opacity',1);
      //active.remove();
      //$("#background").append('<div class="background active" id="'+t+'" style="opacity: 0; "></div>')
      //$("#"+t).css('opacity',1);
      //var el = $("#"+t);
    
      //active.removeClass('active').addClass('last');
      //last.removeClass('last').addClass('active');
      
      //last.dequeue();
      //active.dequeue();
             
      //active.css('opacity',0);
      //alert(last.attr('id'));
      //active.fadeOut('slow');
      //last.fadeIn('slow', function() {
      //});
      
      //last.fadeIn('slow');
      //$("#"+t).css('opacity',1);
      //last.css('opacity',1);
      //el = $("#"+t);
      //el.animate({opacity: 1.0}, 1000);
    
      //if (t==undefined && f == undefined) {
      //} else if (t == f) {
      //}
      //else if (t != undefined) {
      //  $('#background').css("background-image", "url(" + t + ")").fadeIn('slow');
      //} else if (t == undefined) {
      //  $('#background').fadeOut('slow');
      //}
    });
      //current = $('body').css("background-image");
      //alert(current);
  //]]>
</script>
<!-- .slide-footer -->
<!-- =META['title'] -->
<!-- \- -->
<!-- =META['author'] -->
</article>
</body>
</html>
